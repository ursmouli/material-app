<div class="subjects-container">
  <div class="header-section">
    <h2>Subject Management</h2>
    <button mat-raised-button color="primary" (click)="openAddDialog()">
      <mat-icon>add</mat-icon>
      Add New Subject
    </button>
  </div>

  <!-- Search Input -->
  <mat-form-field appearance="outline" class="search-field">
    <mat-label>Search Subjects</mat-label>
    <input matInput
           [(ngModel)]="searchTerm"
           (input)="onSearch()"
           placeholder="Search by name, code, description, or department">
    <mat-icon matSuffix>search</mat-icon>
  </mat-form-field>

  <!-- Subjects Table -->
  <div class="table-container">
    <table mat-table [dataSource]="filteredSubjects" class="subjects-table">

      <!-- ID Column -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let subject">{{ subject.id }}</td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let subject">{{ subject.name }}</td>
      </ng-container>

      <!-- Code Column -->
      <ng-container matColumnDef="code">
        <th mat-header-cell *matHeaderCellDef>Code</th>
        <td mat-cell *matCellDef="let subject">{{ subject.code }}</td>
      </ng-container>

      <!-- Description Column -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Description</th>
        <td mat-cell *matCellDef="let subject" class="description-cell">
          {{ subject.description }}
        </td>
      </ng-container>

      <!-- Credits Column -->
      <ng-container matColumnDef="credits">
        <th mat-header-cell *matHeaderCellDef>Credits</th>
        <td mat-cell *matCellDef="let subject">{{ subject.credits }}</td>
      </ng-container>

      <!-- Department Column -->
      <ng-container matColumnDef="department">
        <th mat-header-cell *matHeaderCellDef>Department</th>
        <td mat-cell *matCellDef="let subject">{{ subject.department.name }}</td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let subject">
          <button mat-icon-button color="primary" (click)="editSubject(subject)" title="Edit">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="deleteSubject(subject)" title="Delete">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <!-- No data message -->
    <div *ngIf="filteredSubjects.length === 0" class="no-data">
      <p>No subjects found matching your search.</p>
    </div>
  </div>
</div>

<!-- Add Subject Dialog -->
<div *ngIf="showAddDialog" class="dialog-overlay" (click)="closeAddDialog()">
  <div class="dialog-content" (click)="$event.stopPropagation()">
    <div class="dialog-header">
      <h3>Add New Subject</h3>
      <button mat-icon-button (click)="closeAddDialog()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="dialog-body">
      <mat-form-field appearance="outline" class="dialog-field">
        <mat-label>Subject Name</mat-label>
        <input matInput [(ngModel)]="newSubject.name" placeholder="e.g., Advanced Mathematics">
      </mat-form-field>

      <mat-form-field appearance="outline" class="dialog-field">
        <mat-label>Subject Code</mat-label>
        <input matInput [(ngModel)]="newSubject.code" placeholder="e.g., MATH201">
      </mat-form-field>

      <mat-form-field appearance="outline" class="dialog-field">
        <mat-label>Description</mat-label>
        <textarea matInput [(ngModel)]="newSubject.description"
                  placeholder="Enter subject description"
                  rows="3"></textarea>
      </mat-form-field>

      <mat-form-field appearance="outline" class="dialog-field">
        <mat-label>Credits</mat-label>
        <input matInput type="number" [(ngModel)]="newSubject.credits" min="1" max="6">
      </mat-form-field>

      <mat-form-field appearance="outline" class="dialog-field">
        <mat-label>Department</mat-label>
        <mat-select [(ngModel)]="newSubject.department" [compareWith]="compareFn">
          <mat-option *ngFor="let department of departments" [value]="department">
            {{ department.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="dialog-actions">
      <button mat-button (click)="closeAddDialog()">Cancel</button>
      @if (newSubject.edit) {
        <button mat-raised-button color="primary" (click)="updateSubject()">Update Subject</button>
      } @else {
        <button mat-raised-button color="primary" (click)="addSubject()">Add Subject</button>
      }
    </div>
  </div>
</div>
