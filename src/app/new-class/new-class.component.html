<div class="new-class-container">
  <mat-card class="class-form-card">
    <mat-card-header>
      <mat-card-title>Create New Class</mat-card-title>
      <mat-card-subtitle>Set up a new class with multiple sections and assign teachers</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="classForm" (ngSubmit)="onSubmit()" class="class-form">

        <!-- Class Basic Information -->
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Class Name</mat-label>
            <input matInput formControlName="name" placeholder="e.g., Grade 10 Science">
            <mat-error *ngIf="classForm.get('name')?.invalid && classForm.get('name')?.touched">
              Class name is required and must be at least 2 characters
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Grade</mat-label>
            <mat-select formControlName="grade">
              <mat-option value="1">Grade 1</mat-option>
              <mat-option value="2">Grade 2</mat-option>
              <mat-option value="3">Grade 3</mat-option>
              <mat-option value="4">Grade 4</mat-option>
              <mat-option value="5">Grade 5</mat-option>
              <mat-option value="6">Grade 6</mat-option>
              <mat-option value="7">Grade 7</mat-option>
              <mat-option value="8">Grade 8</mat-option>
              <mat-option value="9">Grade 9</mat-option>
              <mat-option value="10">Grade 10</mat-option>
              <mat-option value="11">Grade 11</mat-option>
              <mat-option value="12">Grade 12</mat-option>
            </mat-select>
            <mat-error *ngIf="classForm.get('grade')?.invalid && classForm.get('grade')?.touched">
              Grade is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Academic Year</mat-label>
            <input matInput formControlName="academicYear" placeholder="e.g., 2024-2025">
            <mat-error *ngIf="classForm.get('academicYear')?.invalid && classForm.get('academicYear')?.touched">
              Academic year is required
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Sections -->
        <div class="sections-section">
          <div class="section-header">
            <h3>Class Sections</h3>
            <button mat-raised-button color="primary" type="button" (click)="addSection()">
              <mat-icon>add</mat-icon>
              Add Section
            </button>
          </div>

          <div formArrayName="sections" class="sections-container">
            <mat-card *ngFor="let section of sections.controls; let i = index" [formGroupName]="i" class="section-card">
              <mat-card-header>
                <mat-card-title>Section {{ i + 1 }}</mat-card-title>
                <button mat-icon-button color="warn" type="button" (click)="removeSection(i)"
                        [disabled]="sections.length === 1" class="remove-section-btn">
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-card-header>

              <mat-card-content>
                <div class="section-form-row">
                  <mat-form-field appearance="outline" class="section-field">
                    <mat-label>Section Name</mat-label>
                    <input matInput formControlName="name" placeholder="e.g., Section A">
                    <mat-error *ngIf="section.get('name')?.invalid && section.get('name')?.touched">
                      Section name is required
                    </mat-error>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="section-field">
                    <mat-label>Class Teacher</mat-label>
                    <mat-select formControlName="teacherId">
                      <mat-option *ngFor="let teacher of availableTeachers" [value]="teacher.id">
                        {{ teacher.name }} - {{ teacher.subject }}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="section.get('teacherId')?.invalid && section.get('teacherId')?.touched">
                      Teacher selection is required
                    </mat-error>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="section-field">
                    <mat-label>Capacity</mat-label>
                    <input matInput type="number" formControlName="capacity" min="1" max="50">
                    <mat-error *ngIf="section.get('capacity')?.invalid && section.get('capacity')?.touched">
                      Capacity must be between 1 and 50
                    </mat-error>
                  </mat-form-field>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
          <button mat-raised-button color="primary" type="submit" [disabled]="!classForm.valid">
            <mat-icon>save</mat-icon>
            Create Class
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
