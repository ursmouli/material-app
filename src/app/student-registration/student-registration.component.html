<!-- <h2>Webcam Live View</h2>
<webcam
  [height]="500"
  [width]="500"
></webcam> -->

<mat-card>
	<mat-card-header>
		<mat-card-title>Student Registration</mat-card-title>
	</mat-card-header>
	<mat-card-content>
		<form [formGroup]="studentForm" (ngSubmit)="onSubmit()">
			<!-- Basic Information -->
			<fieldset class="form-section">
				<legend>Basic Information</legend>

				<div class="form-row">
					<mat-form-field appearance="outline">
						<mat-label>First Name</mat-label>
						<input matInput formControlName="firstName" required>
					</mat-form-field>
					<mat-form-field appearance="outline">
						<mat-label>Middle Name</mat-label>
						<input matInput formControlName="middleName">
					</mat-form-field>

					<mat-form-field appearance="outline">
						<mat-label>Last Name</mat-label>
						<input matInput formControlName="lastName" required>
					</mat-form-field>
				</div>
				<div class="form-row">
					<div class="radio-group">
						<label>Gender</label>
						<mat-radio-group formControlName="gender">
							<mat-radio-button value="male">Male</mat-radio-button>
							<mat-radio-button value="female">Female</mat-radio-button>
						</mat-radio-group>
					</div>
				</div>
				<div class="form-row">
					<mat-form-field appearance="outline">
						<mat-label>Date of Birth</mat-label>
						<input matInput [matDatepicker]="picker" formControlName="dob" required>
						<mat-hint>MM/DD/YYYY</mat-hint>
						<mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
						<mat-datepicker #picker></mat-datepicker>

						@if (studentForm.get('dob')?.hasError('required')) {
							<mat-error>Date of birth is required</mat-error>
						}
						@if (studentForm.get('dob')?.errors?.['tooYoung']) {
							<mat-error>You must be at least before {{ cutoffDate | date:'yyyy-MM-dd' }}</mat-error>
						}
					</mat-form-field>
					<!-- Dropdown blood group -->
					<mat-form-field appearance="outline">
						<mat-label>Blood Group</mat-label>
						<mat-select formControlName="bloodGroup">
							<mat-option value="A+">A+</mat-option>
							<mat-option value="A-">A-</mat-option>
							<mat-option value="B+">B+</mat-option>
							<mat-option value="B-">B-</mat-option>
							<mat-option value="AB+">AB+</mat-option>
							<mat-option value="AB-">AB-</mat-option>
							<mat-option value="O+">O+</mat-option>
							<mat-option value="O-">O-</mat-option>
						</mat-select>
					</mat-form-field>
				</div>
				<div class="form-row">
					<mat-form-field appearance="outline">
						<mat-label>Is residential address same as permanent?</mat-label>
						<mat-select formControlName="isResidentialSameAsPermanent">
							<mat-option value="yes">Yes</mat-option>
							<mat-option value="no">No</mat-option>
						</mat-select>
					</mat-form-field>
				</div>
			</fieldset>

			<!-- Permanent Address -->
			<fieldset class="form-section">
				<legend>Permanent Address</legend>
				<div formGroupName="permanentAddress">
					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>House Number</mat-label>
							<input matInput formControlName="houseNumber">
						</mat-form-field>

						<mat-form-field appearance="outline">
							<mat-label>Street</mat-label>
							<input matInput formControlName="street">
						</mat-form-field>

						<mat-form-field appearance="outline">
							<mat-label>Land Mark</mat-label>
							<input matInput formControlName="landMark">
						</mat-form-field>
					</div>
					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>Place City/Town/Village</mat-label>
							<input matInput formControlName="place" required>
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>Postalcode</mat-label>
							<input matInput formControlName="postalCode">
						</mat-form-field>
					</div>
					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>Camp, Colony</mat-label>
							<input matInput formControlName="addressLine1" required>
						</mat-form-field>
					</div>
					<div class="form-row">
						<input type="hidden" formControlName="country">
						<mat-form-field appearance="outline">
							<mat-label>State</mat-label>
							<mat-select formControlName="state" required>
								@if (pIndianStates$ | async; as indianStates) {
								@for (state of indianStates; track state.id) {
								<mat-option [value]="state.id">{{ state.name }}</mat-option>
								}
								}
							</mat-select>
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>District</mat-label>
							<mat-select formControlName="district" required>
								@if (pStateDistricts$ | async; as districts) {
								@for (district of districts; track district.id) {
								<mat-option [value]="district.id">{{ district.name }}</mat-option>
								}
								}
							</mat-select>
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>Taluk</mat-label>
							<mat-select formControlName="taluk" required>
								@if (pDistrictTaluks$ | async; as taluks) {
								@for (taluk of taluks; track taluk.id) {
								<mat-option [value]="taluk.id">{{ taluk.name }}</mat-option>
								}
								}
							</mat-select>
						</mat-form-field>
					</div>
				</div>
			</fieldset>

			<!-- Residential Address -->
			@if (studentForm.get('isResidentialSameAsPermanent')?.touched &&
			studentForm.get('isResidentialSameAsPermanent')?.value === 'no') {
			<fieldset class="form-section">
				<legend>Residential Address</legend>
				<div formGroupName="residentialAddress">
					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>House Number</mat-label>
							<input matInput formControlName="houseNumber">
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>Street</mat-label>
							<input matInput formControlName="street">
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>Land Mark</mat-label>
							<input matInput formControlName="landMark">
						</mat-form-field>
					</div>
					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>Place City/Town/Village</mat-label>
							<input matInput formControlName="place" required>
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>Postalcode</mat-label>
							<input matInput formControlName="postalCode">
						</mat-form-field>
					</div>

					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>Camp, Colony</mat-label>
							<input matInput formControlName="addressLine1" required>
						</mat-form-field>
					</div>
					<div class="form-row">
						<input type="hidden" formControlName="country">
						<mat-form-field appearance="outline">
							<mat-label>State</mat-label>
							<mat-select formControlName="state" required>
								@if (rIndianStates$ | async; as states) {
								@for (state of states; track state.id) {
								<mat-option [value]="state.id">{{ state.name }}</mat-option>
								}
								}
							</mat-select>
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>District</mat-label>
							@if (rStateDistricts$ | async; as districts) {
							<mat-select formControlName="district" required>
								@for (district of districts; track district.id) {
								<mat-option [value]="district.id">{{ district.name }}</mat-option>
								}
							</mat-select>
							}
						</mat-form-field>

						<mat-form-field appearance="outline">
							<mat-label>Taluk</mat-label>
							@if (rDistrictTaluks$ | async; as taluks) {
							<mat-select formControlName="taluk" required>
								@for (taluk of taluks; track taluk.id) {
								<mat-option [value]="taluk.id">{{ taluk.name }}</mat-option>
								}
							</mat-select>
							}
						</mat-form-field>
					</div>
				</div>
			</fieldset>
			}

			<fieldset class="form-section">
				<legend>Guardian</legend>
				<div formGroupName="guardian">
					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>Guardian Type</mat-label>
							@if (relationshipTypes$ | async; as relations) {
							<mat-select formControlName="relation" required>
								@for (relation of relations; track relation) {
								<mat-option [value]="relation">{{ relation }}</mat-option>
								}
							</mat-select>
							}
						</mat-form-field>

						<mat-form-field appearance="outline">
							<mat-label>Guardian Name</mat-label>
							<input matInput formControlName="name" required>
						</mat-form-field>
					</div>
					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>Guardian Phone</mat-label>
							<input matInput formControlName="phone" required>
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>Guardian Email</mat-label>
							<input matInput formControlName="email" required>
						</mat-form-field>
					</div>
				</div>
			</fieldset>

			<fieldset class="form-section">
				<legend>Siblings</legend>

				<div formArrayName="siblings">
					<div *ngFor="let sibling of siblings.controls; let i = index" [formGroupName]="i">
						<fieldset class="form-section">
							<legend>
								Sibling {{ i + 1 }}
								<button mat-icon-button type="button" (click)="removeSibling(i)">
									<mat-icon>delete</mat-icon>
								</button>
							</legend>
							<div class="form-row">
								<mat-form-field appearance="outline">
									<mat-label>Relation</mat-label>
									@if (relationshipTypes$ | async; as relations) {
									<mat-select formControlName="relation" required>
										@for (relation of relations; track relation) {
										<mat-option [value]="relation">{{ relation }}</mat-option>
										}
									</mat-select>
									}
								</mat-form-field>

								<mat-form-field appearance="outline">
									<mat-label>Name</mat-label>
									<input matInput formControlName="name" required>
								</mat-form-field>

								<mat-form-field appearance="outline">
									<mat-label>Date of Birth</mat-label>
									<input matInput [matDatepicker]="siblingPicker" formControlName="dob" required>
									<mat-hint>MM/DD/YYYY</mat-hint>
									<mat-datepicker-toggle matSuffix [for]="siblingPicker"></mat-datepicker-toggle>
									<mat-datepicker #siblingPicker></mat-datepicker>
								</mat-form-field>
							</div>
							<div class="form-row">
								<mat-form-field appearance="outline">
									<mat-label>Institution Name</mat-label>
									<input matInput formControlName="institutionName">
								</mat-form-field>

								<mat-form-field appearance="outline">
									<mat-label>Institution Place</mat-label>
									<input matInput formControlName="institutionPlace">
								</mat-form-field>

							</div>
						</fieldset>
					</div>
				</div>

				<button mat-button type="button" (click)="addSibling()">Add Sibling</button>
			</fieldset>

			<button mat-raised-button color="primary" type="submit" [disabled]="!studentForm.valid">Register</button>
		</form>

	</mat-card-content>
</mat-card>